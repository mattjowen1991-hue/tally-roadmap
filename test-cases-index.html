<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tally — Test Cases</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0a0e27;
  --bg-secondary: #121630;
  --bg-card: rgba(25, 31, 61, 0.6);
  --accent-primary: #00d4ff;
  --accent-secondary: #7c3aed;
  --accent-green: #34C759;
  --text-primary: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --border: rgba(255, 255, 255, 0.08);
  --glass: rgba(255, 255, 255, 0.03);
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    radial-gradient(circle at 20% 50%, rgba(124, 58, 237, 0.12) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.12) 0%, transparent 50%),
    radial-gradient(circle at 40% 90%, rgba(245, 158, 11, 0.08) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

.container {
  position: relative;
  z-index: 1;
  max-width: 900px;
  margin: 0 auto;
  padding: 24px 20px 80px;
}

/* Header */
.header {
  text-align: center;
  padding: 40px 0 32px;
}
.header svg { display: inline-block; }
.header-sub {
  font-size: 14px;
  color: var(--text-secondary);
  margin-top: 6px;
}
.header-title {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 600;
  font-size: 28px;
  margin-top: 20px;
  letter-spacing: -0.02em;
}
.header-meta {
  display: flex;
  justify-content: center;
  gap: 24px;
  margin-top: 16px;
  flex-wrap: wrap;
}
.meta-pill {
  font-size: 13px;
  color: var(--text-secondary);
  background: var(--glass);
  border: 1px solid var(--border);
  padding: 6px 16px;
  border-radius: 20px;
}
.meta-pill strong {
  color: var(--accent-primary);
  font-weight: 600;
}

/* Progress bar */
.progress-sticky {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(10, 14, 39, 0.92);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  padding: 12px 0;
  margin: 0 -20px;
  padding-left: 20px;
  padding-right: 20px;
}
.progress-bar-wrap {
  display: flex;
  align-items: center;
  gap: 14px;
}
.progress-track {
  flex: 1;
  height: 8px;
  background: var(--glass);
  border-radius: 4px;
  border: 1px solid var(--border);
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-green));
  border-radius: 4px;
  transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
.progress-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  color: var(--accent-primary);
  min-width: 52px;
  text-align: right;
  font-weight: 500;
}
.progress-counts {
  display: flex;
  gap: 16px;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 6px;
}
.progress-counts span { display: flex; align-items: center; gap: 5px; }
.dot-pass { width: 8px; height: 8px; border-radius: 50%; background: var(--success); }
.dot-fail { width: 8px; height: 8px; border-radius: 50%; background: var(--danger); }
.dot-skip { width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted); }

/* Section */
.section {
  margin-top: 36px;
}
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  padding: 16px 20px;
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 16px;
  transition: all 0.2s;
  user-select: none;
}
.section-header:hover {
  border-color: rgba(255,255,255,0.12);
  background: rgba(25, 31, 61, 0.8);
}
.section-header-left {
  display: flex;
  align-items: center;
  gap: 14px;
}
.section-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  font-weight: 500;
  color: var(--accent-primary);
  background: rgba(0, 212, 255, 0.1);
  border: 1px solid rgba(0, 212, 255, 0.25);
  padding: 4px 10px;
  border-radius: 8px;
}
.section-title {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 600;
  font-size: 20px;
  letter-spacing: -0.02em;
}
.section-header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}
.section-progress {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text-muted);
}
.section-chevron {
  width: 20px;
  height: 20px;
  transition: transform 0.3s;
  color: var(--text-muted);
}
.section.open .section-chevron {
  transform: rotate(180deg);
}
.section-body {
  display: none;
  padding: 12px 0 0;
}
.section.open .section-body {
  display: block;
}

/* Test case card */
.tc-card {
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: 14px;
  margin-bottom: 10px;
  overflow: hidden;
  transition: all 0.25s;
}
.tc-card.pass {
  border-color: rgba(16, 185, 129, 0.3);
}
.tc-card.fail {
  border-color: rgba(239, 68, 68, 0.3);
}
.tc-top {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
}
.tc-id {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--accent-primary);
  background: rgba(0, 212, 255, 0.08);
  padding: 3px 8px;
  border-radius: 6px;
  white-space: nowrap;
  flex-shrink: 0;
}
.tc-name {
  flex: 1;
  font-weight: 600;
  font-size: 14px;
}
.tc-priority {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.05em;
  padding: 3px 10px;
  border-radius: 6px;
  flex-shrink: 0;
}
.tc-priority.high {
  color: var(--danger);
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
}
.tc-priority.med {
  color: var(--warning);
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.3);
}
.tc-priority.low {
  color: var(--success);
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.3);
}
.tc-details {
  padding: 0 16px 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.tc-row {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.5;
  padding: 8px 12px;
  background: var(--glass);
  border-radius: 8px;
  border: 1px solid var(--border);
}
.tc-row strong {
  color: var(--text-primary);
  font-weight: 600;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.tc-actions {
  display: flex;
  gap: 8px;
  padding: 0 16px 14px;
}
.tc-btn {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--glass);
  color: var(--text-muted);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-family: 'DM Sans', sans-serif;
}
.tc-btn:hover { background: rgba(255,255,255,0.05); }
.tc-btn.pass-btn.active {
  background: rgba(16, 185, 129, 0.15);
  border-color: rgba(16, 185, 129, 0.4);
  color: var(--success);
}
.tc-btn.fail-btn.active {
  background: rgba(239, 68, 68, 0.15);
  border-color: rgba(239, 68, 68, 0.4);
  color: var(--danger);
}
.tc-btn.skip-btn.active {
  background: rgba(100, 116, 139, 0.15);
  border-color: rgba(100, 116, 139, 0.4);
  color: var(--text-muted);
}

/* Notes area */
.tc-notes {
  display: none;
  padding: 0 16px 14px;
}
.tc-card.fail .tc-notes { display: block; }
.tc-notes textarea {
  width: 100%;
  min-height: 60px;
  background: var(--glass);
  border: 1px solid rgba(239, 68, 68, 0.2);
  border-radius: 10px;
  color: var(--text-primary);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  padding: 10px 12px;
  resize: vertical;
}
.tc-notes textarea:focus {
  outline: none;
  border-color: rgba(239, 68, 68, 0.4);
}
.tc-notes textarea::placeholder { color: var(--text-muted); }

/* Reset button */
.reset-wrap {
  text-align: center;
  margin-top: 40px;
  padding-bottom: 40px;
}
.reset-btn {
  padding: 12px 32px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--glass);
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.2s;
}
.reset-btn:hover {
  border-color: rgba(239, 68, 68, 0.4);
  color: var(--danger);
  background: rgba(239, 68, 68, 0.08);
}

/* Print styles */
@media print {
  body { background: #fff; color: #000; }
  body::before { display: none; }
  .progress-sticky { display: none; }
  .tc-btn { border: 1px solid #ccc; }
  .section-body { display: block !important; }
  .tc-card { break-inside: avoid; border: 1px solid #ddd; }
}

@media (max-width: 600px) {
  .container { padding: 16px 12px 80px; }
  .header-meta { gap: 8px; }
  .meta-pill { font-size: 12px; padding: 5px 12px; }
  .section-title { font-size: 17px; }
  .tc-top { flex-wrap: wrap; gap: 8px; }
  .tc-name { min-width: 100%; order: 3; }
  .tc-actions { flex-wrap: wrap; }
  .progress-sticky { margin: 0 -12px; padding-left: 12px; padding-right: 12px; }
}
</style>
</head>
<body>
<div class="container" id="app">

  <!-- Header -->
  <div class="header">
    <svg width="140" viewBox="10 30 400 120" fill="none">
      <defs>
        <linearGradient id="wg" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#2F6BFF"/>
          <stop offset="55%" stop-color="#22C3A6"/>
          <stop offset="100%" stop-color="#7AD957"/>
        </linearGradient>
      </defs>
      <text x="210" y="118" text-anchor="middle" fill="url(#wg)" font-size="110" font-weight="800" letter-spacing="-6" font-family="ui-rounded,'SF Pro Rounded',Nunito,Quicksand,system-ui,Arial" transform="skewX(-6)">
        <tspan>T</tspan><tspan dx="-16" dy="4">a</tspan><tspan dy="-3">l</tspan><tspan dy="5">l</tspan><tspan dy="-4">y</tspan>
      </text>
    </svg>
    <div class="header-sub">Finance tracking made easy</div>
    <div class="header-title">Test Cases v4.1</div>
    <div class="header-meta">
      <span class="meta-pill"><strong>87</strong> test cases</span>
      <span class="meta-pill"><strong>11</strong> sections</span>
      <span class="meta-pill">Vite + React Migration</span>
    </div>
  </div>

  <!-- Progress -->
  <div class="progress-sticky">
    <div class="progress-bar-wrap">
      <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-label" id="progressLabel">0%</div>
    </div>
    <div class="progress-counts">
      <span><span class="dot-pass"></span> <span id="countPass">0</span> passed</span>
      <span><span class="dot-fail"></span> <span id="countFail">0</span> failed</span>
      <span><span class="dot-skip"></span> <span id="countSkip">0</span> skipped</span>
    </div>
  </div>

  <!-- Sections injected by JS -->
  <div id="sections"></div>

  <div class="reset-wrap">
    <button class="reset-btn" onclick="resetAll()">Reset All Results</button>
  </div>
</div>

<script>
const DATA = [
  { num: '1', title: 'Splash Screen & Startup', cases: [
    { id: 'TC-1.1', name: 'Splash screen displays on launch', pri: 'HIGH',
      steps: 'Open the app from closed state.',
      expected: 'Animated splash appears with dark background. Logo bars drop in sequentially, strike draws across, and "Tally" wordmark reveals with diagonal mask animation.' },
    { id: 'TC-1.2', name: 'Splash animation timing', pri: 'MED',
      steps: 'Watch the full splash sequence.',
      expected: 'Bars stagger 0–480ms, strike at 740ms, wordmark reveal at 1340ms, fade at 1460ms, fade-out begins at 2600ms, fully gone by ~3100ms.' },
    { id: 'TC-1.3', name: 'Native splash dismissed first', pri: 'HIGH',
      steps: 'Cold start the app on device.',
      expected: 'Native Capacitor splash hides, then CSS animated splash plays immediately. No overlap or double-splash.' },
    { id: 'TC-1.4', name: 'Wordmark matches in-app branding', pri: 'MED',
      steps: 'Compare splash "Tally" to the header wordmark.',
      expected: 'Both use same rounded font stack, weight 800, letter-spacing -6, skewX(-6), blue-to-green gradient.' },
    { id: 'TC-1.5', name: 'Background matches app theme', pri: 'LOW',
      steps: 'Observe splash background colour.',
      expected: 'Background is #0a0e27 (var(--bg-primary)), matching the app dark theme exactly.' },
    { id: 'TC-1.6', name: 'App loads after splash', pri: 'HIGH',
      steps: 'Wait for splash to fade out.',
      expected: 'App content (header, sticky nav dots, Overview panel) is visible and interactive.' },
    { id: 'TC-1.7', name: 'Splash does not replay', pri: 'MED',
      steps: 'After app loads, switch panels and return to Overview.',
      expected: 'Splash only shows once on initial load, never replays.' },
    { id: 'TC-1.8', name: 'Browser fallback (no Capacitor)', pri: 'LOW',
      steps: 'Open in a desktop browser via npm run dev.',
      expected: 'Splash plays immediately. App loads normally after. Storage uses localStorage fallback.' },
  ]},
  { num: '2', title: 'Navigation & Swipe', cases: [
    { id: 'TC-2.1', name: 'Sticky nav dots visible on mobile', pri: 'HIGH',
      steps: 'Open app on mobile screen (<=768px).',
      expected: 'Five nav dots: Overview, Actions, Bills, Debt, Savings. Overview active by default. Nav is sticky — remains visible when scrolling down.' },
    { id: 'TC-2.2', name: 'Tap nav dot to switch panel', pri: 'HIGH',
      steps: 'Tap on "Bills" nav dot.',
      expected: 'Panel transitions to Bills. Bills dot becomes active (wider, gradient, blue label).' },
    { id: 'TC-2.3', name: 'Swipe left to next panel', pri: 'HIGH',
      steps: 'From Overview, swipe left.',
      expected: 'Panel slides to Actions. Nav dot updates.' },
    { id: 'TC-2.4', name: 'Swipe right to previous panel', pri: 'HIGH',
      steps: 'From Actions, swipe right.',
      expected: 'Panel slides back to Overview.' },
    { id: 'TC-2.5', name: 'Swipe resistance at edges', pri: 'MED',
      steps: 'On Overview, try swiping right (past first panel).',
      expected: 'Rubber-band effect (20% movement), snaps back.' },
    { id: 'TC-2.6', name: 'Category scroll independent of swipe', pri: 'HIGH',
      steps: 'On Bills panel, horizontally scroll the category buttons.',
      expected: 'Category scroll works independently. Panel does not swipe.' },
    { id: 'TC-2.7', name: 'Vertical scroll unaffected', pri: 'MED',
      steps: 'On a long panel, scroll vertically.',
      expected: 'Vertical scroll works normally. Swipe only on horizontal > 1.2x vertical.' },
    { id: 'TC-2.8', name: 'Quick successive panel changes', pri: 'LOW',
      steps: 'Rapidly tap different nav dots.',
      expected: 'Each panel loads without glitches or stuck states.' },
    { id: 'TC-2.9', name: 'Sticky nav stays visible on scroll', pri: 'HIGH',
      steps: 'On Bills panel with many bills, scroll down.',
      expected: 'Nav dots remain pinned to top with blurred background. Tally header scrolls away.' },
  ]},
  { num: '3', title: 'Overview Panel', cases: [
    { id: 'TC-3.1', name: 'Income card displays correctly', pri: 'HIGH',
      steps: 'View the Overview panel.',
      expected: 'Income card: "INCOME" label, green icon, formatted £ amount, "Monthly income" subtitle.' },
    { id: 'TC-3.2', name: 'Expenses card correct total', pri: 'HIGH',
      steps: 'View the Expenses stat card.',
      expected: 'Sum of all actual amounts. "X of Y bills paid" subtitle.' },
    { id: 'TC-3.3', name: 'Balance calculates correctly', pri: 'HIGH',
      steps: 'Compare Income minus Expenses to Balance.',
      expected: 'Balance = Income - Actual. Green if positive, red if negative.' },
    { id: 'TC-3.4', name: 'Variance card', pri: 'MED',
      steps: 'View Variance card.',
      expected: 'Actual vs projected difference. Zero=green, over=red "+", under=blue.' },
    { id: 'TC-3.5', name: 'Doughnut chart renders', pri: 'HIGH',
      steps: 'Scroll to Expense Breakdown.',
      expected: 'Chart displays coloured segments per category. Tooltip shows £ on tap.' },
    { id: 'TC-3.6', name: 'Legend matches chart', pri: 'MED',
      steps: 'Compare legend items to chart.',
      expected: 'Matching colour dots, names, £ amounts, percentages summing to ~100%.' },
    { id: 'TC-3.7', name: 'Stats update on bill change', pri: 'HIGH',
      steps: 'Toggle a bill paid status, return to Overview.',
      expected: 'All stats and chart reflect the change.' },
  ]},
  { num: '4', title: 'Actions Panel', cases: [
    { id: 'TC-4.1', name: 'Monthly Income input', pri: 'HIGH',
      steps: 'Change income to 2500 on Actions panel.',
      expected: 'Overview Income and Balance cards reflect new value.' },
    { id: 'TC-4.2', name: 'Add New Bill opens modal', pri: 'HIGH',
      steps: 'Tap "Add New Bill" (blue/purple gradient button).',
      expected: 'Modal slides up with blur overlay.' },
    { id: 'TC-4.3', name: 'Manage Categories opens modal', pri: 'MED',
      steps: 'Tap "Manage Categories".',
      expected: 'Category modal opens with default and custom lists.' },
    { id: 'TC-4.4', name: 'Category Summary totals', pri: 'MED',
      steps: 'View Category Summary section.',
      expected: 'Each category shows name and total matching Overview chart.' },
    { id: 'TC-4.5', name: 'Decimal income values', pri: 'LOW',
      steps: 'Enter 1960.50.',
      expected: 'Accepted, displays correctly, balance recalculates.' },
    { id: 'TC-4.6', name: 'Zero / empty income', pri: 'LOW',
      steps: 'Enter 0, then clear field.',
      expected: 'Zero shows £0.00. Empty field allowed while typing, defaults to 0 on blur. No crash.' },
    { id: 'TC-4.7', name: 'Add New Debt opens modal', pri: 'HIGH',
      steps: 'Tap "Add New Debt" (red/purple gradient button).',
      expected: 'Debt modal opens with name, type, balance, interest rate, min payment, and auto monthly fields.' },
    { id: 'TC-4.8', name: 'Add Savings Goal opens modal', pri: 'HIGH',
      steps: 'Tap "Add Savings Goal" (green/cyan gradient button).',
      expected: 'Savings modal opens with name, category, target amount, and monthly auto-save fields.' },
  ]},
  { num: '5', title: 'Bills — Viewing & Filtering', cases: [
    { id: 'TC-5.1', name: 'Category tabs filter', pri: 'HIGH',
      steps: 'Tap "ENTERTAINMENT" tab.',
      expected: 'Only entertainment bills shown. Count updates. Tab active.' },
    { id: 'TC-5.2', name: 'Filter — Paid', pri: 'HIGH',
      steps: 'Select "Paid" pill.',
      expected: 'Only paid bills shown. Active pill uses accent-primary colour scheme.' },
    { id: 'TC-5.3', name: 'Filter — Unpaid', pri: 'HIGH',
      steps: 'Select "Unpaid" pill.',
      expected: 'Only unpaid, non-missed, non-paused bills.' },
    { id: 'TC-5.4', name: 'Filter — Missed', pri: 'MED',
      steps: 'Select "Missed" pill.',
      expected: 'Only missed bills shown. Active pill uses accent-primary colour scheme.' },
    { id: 'TC-5.5', name: 'Filter — Paused', pri: 'MED',
      steps: 'Select "Paused" pill.',
      expected: 'Only paused bills shown. Plain text label, consistent styling with other pills.' },
    { id: 'TC-5.6', name: 'Filter — Recurring', pri: 'MED',
      steps: 'Select "Recurring" pill.',
      expected: 'Only recurring bills. Plain text label, consistent styling with other pills.' },
    { id: 'TC-5.7', name: 'Combined category + status', pri: 'HIGH',
      steps: 'Select HOME + "Paid".',
      expected: 'Only paid HOME bills. Both filters apply.' },
    { id: 'TC-5.8', name: 'Status badges on cards', pri: 'MED',
      steps: 'View bill cards.',
      expected: 'Paid=green border+badge. Missed=red. Paused=yellow.' },
    { id: 'TC-5.9', name: 'All filter pills consistent', pri: 'MED',
      steps: 'View all filter pills (All, Paid, Unpaid, Missed, Paused, Recurring, One-off).',
      expected: 'All pills use plain text labels with no emojis. Active state uses accent-primary border and background tint.' },
  ]},
  { num: '6', title: 'Bills — CRUD Operations', cases: [
    { id: 'TC-6.1', name: 'Add a one-off bill', pri: 'HIGH',
      steps: 'Add: Name="Plumber", HOME, £150, One-off, select due date.',
      expected: 'Bill appears in HOME. "One-off" badge. £150.00 projected and actual.' },
    { id: 'TC-6.2', name: 'Validation — empty name', pri: 'HIGH',
      steps: 'Leave name empty, tap Add.',
      expected: 'Red error border on name. Not added.' },
    { id: 'TC-6.3', name: 'Validation — empty amount', pri: 'HIGH',
      steps: 'Enter name, leave amount empty.',
      expected: 'Red error border on amount. Not added.' },
    { id: 'TC-6.4', name: 'Edit name and amount', pri: 'HIGH',
      steps: 'Tap edit, change name + actual to 99.99, Save.',
      expected: 'Card updates. Variance recalculates.' },
    { id: 'TC-6.5', name: 'Edit — change category', pri: 'MED',
      steps: 'Edit bill, change HOME to ENTERTAINMENT.',
      expected: 'Bill moves. Both category totals update.' },
    { id: 'TC-6.6', name: 'Delete bill', pri: 'HIGH',
      steps: 'Tap trash, confirm.',
      expected: 'Confirmation dialog. Bill removed. Totals update.' },
    { id: 'TC-6.7', name: 'Toggle paid', pri: 'HIGH',
      steps: 'Tap checkbox on unpaid bill.',
      expected: 'Green checkbox, green border, "Paid" badge.' },
    { id: 'TC-6.8', name: 'Toggle missed', pri: 'HIGH',
      steps: 'Tap X button on a bill.',
      expected: 'Red X, red border, "Missed" badge. Paid cleared.' },
    { id: 'TC-6.9', name: 'Toggle paused (one-off)', pri: 'MED',
      steps: 'Tap pause on a one-off bill.',
      expected: 'Yellow border, "Paused" badge. Only on non-recurring.' },
    { id: 'TC-6.10', name: 'Cancel resets form', pri: 'MED',
      steps: 'Open Add modal, fill fields, tap Cancel.',
      expected: 'Modal closes. No bill added. Form reset.' },
    { id: 'TC-6.11', name: 'Number fields allow clearing (no sticky 0)', pri: 'HIGH',
      steps: 'Edit a bill, select the Projected or Actual field, delete all digits.',
      expected: 'Field clears completely. No sticky 0 appears. Value defaults to 0 on blur (tapping away).' },
  ]},
  { num: '7', title: 'Bills — Recurring & Auto-Pay', cases: [
    { id: 'TC-7.1', name: 'Monthly recurring bill', pri: 'HIGH',
      steps: 'Add: Recurring, Monthly, Day=1, £50.',
      expected: '"Recurring" badge. Auto-marks paid if today >= 1st.' },
    { id: 'TC-7.2', name: 'Weekly recurring', pri: 'MED',
      steps: 'Add: Recurring, Weekly, Day=Monday.',
      expected: 'Auto-pays on Mondays.' },
    { id: 'TC-7.3', name: 'Fortnightly recurring', pri: 'MED',
      steps: 'Add: Recurring, Fortnightly, Day=Friday, start date.',
      expected: 'Fortnightly cycle. Requires start date.' },
    { id: 'TC-7.4', name: 'Quarterly recurring', pri: 'MED',
      steps: 'Add: Recurring, Quarterly, Day=15, Start=January.',
      expected: 'Auto-pays 15th of Jan, Apr, Jul, Oct.' },
    { id: 'TC-7.5', name: 'Yearly recurring', pri: 'LOW',
      steps: 'Add: Recurring, Yearly, select annual date.',
      expected: 'Auto-pays once per year on selected date.' },
    { id: 'TC-7.6', name: 'Missed blocks auto-pay', pri: 'HIGH',
      steps: 'Mark recurring as missed.',
      expected: 'Never auto-paid. Shows "Paused until paid" warning.' },
    { id: 'TC-7.7', name: 'Paused blocks auto-pay', pri: 'MED',
      steps: 'Pause a bill.',
      expected: 'Does not auto-pay even if date conditions met.' },
    { id: 'TC-7.8', name: 'New month resets paid', pri: 'HIGH',
      steps: 'Simulate month change, reopen app.',
      expected: 'Non-missed bills reset. Auto-pay re-evaluates.' },
  ]},
  { num: '8', title: 'Debt Tracking', cases: [
    { id: 'TC-8.1', name: 'Add a new debt', pri: 'HIGH',
      steps: 'Tap "+ Add" on Debt panel or "Add New Debt" on Actions. Enter: "Visa Card", Credit Card, £2000, 19.9% APR, Min £25, Auto £100/mo.',
      expected: '£2,000.00 balance. Progress bar shows 0%. Info pills: "Min: £25.00", "Auto: £100.00/mo".' },
    { id: 'TC-8.2', name: 'Debt validation', pri: 'HIGH',
      steps: 'Try empty name or balance.',
      expected: 'Not added. Modal stays open.' },
    { id: 'TC-8.3', name: 'Debt card displays correctly', pri: 'HIGH',
      steps: 'View a debt card.',
      expected: 'Shows: name, type, APR, balance, progress bar, info pills (min payment, auto monthly, payment count), payment input, and collapsible Payment History.' },
    { id: 'TC-8.4', name: 'Manual payment', pri: 'HIGH',
      steps: 'Enter 100, tap Pay.',
      expected: 'Balance -£100. Progress bar updates. Collapsible "Payment History" shows "Manual payment" entry with date and -£100.00.' },
    { id: 'TC-8.5', name: 'Payment capped at balance', pri: 'MED',
      steps: 'Enter payment > remaining balance.',
      expected: 'Balance becomes £0. "Paid off!" green badge. Payment input hidden.' },
    { id: 'TC-8.6', name: 'Payoff calculator', pri: 'MED',
      steps: 'Enter £300 in the Payoff Calculator monthly amount.',
      expected: 'Shows each active debt with months to clear and total interest. Debts with payments below interest show "Payment too low to cover interest".' },
    { id: 'TC-8.7', name: 'Payment history collapsible', pri: 'MED',
      steps: 'Make a payment, then tap "Payment History (N)".',
      expected: 'History expands with chevron rotation. Shows entries in reverse chronological order with type (Manual/Auto), date, and amount.' },
    { id: 'TC-8.8', name: 'Edit debt', pri: 'HIGH',
      steps: 'Tap pencil icon, change name + recurring amount, tap Save.',
      expected: 'Values update. Info pills reflect changes.' },
    { id: 'TC-8.9', name: 'Delete debt', pri: 'MED',
      steps: 'Tap trash icon, confirm.',
      expected: 'Removed. Total debt summary updates.' },
    { id: 'TC-8.10', name: 'Auto-reduce on new month', pri: 'HIGH',
      steps: 'Set recurring payment. Simulate month change.',
      expected: 'Balance auto-reduces by recurring amount. "Auto-payment" entry appears in Payment History.' },
    { id: 'TC-8.11', name: 'Debt summary cards', pri: 'MED',
      steps: 'View the top of the Debt panel.',
      expected: 'Total Debt (red if > 0, green if 0) and Active Debts count.' },
  ]},
  { num: '9', title: 'Savings Goals', cases: [
    { id: 'TC-9.1', name: 'Add savings goal', pri: 'HIGH',
      steps: 'Tap "+ Add" on Savings panel or "Add Savings Goal" on Actions. Enter: "Holiday Fund", Holiday, Target=2000, Monthly=100.',
      expected: '£0.00 of £2,000.00 (0%). Holiday category. "Auto: £100.00/mo" pill. "~20 months to go" estimate pill.' },
    { id: 'TC-9.2', name: 'Savings validation', pri: 'HIGH',
      steps: 'Try empty name.',
      expected: 'Not added. Modal stays open. Target can be left empty for open-ended goals.' },
    { id: 'TC-9.3', name: 'No-target savings goal', pri: 'MED',
      steps: 'Add goal with empty target amount.',
      expected: 'Goal shows current amount only, no progress bar, no percentage, no estimate.' },
    { id: 'TC-9.4', name: 'Make deposit', pri: 'HIGH',
      steps: 'Enter 200, tap "Deposit".',
      expected: '+£200. Progress bar updates. Collapsible "Transaction History" shows "Deposit" entry with date and +£200.00 in green.' },
    { id: 'TC-9.5', name: 'Make withdrawal', pri: 'HIGH',
      steps: 'Enter 50, tap "Withdraw".',
      expected: '-£50 from balance. Cannot go below £0. "Transaction History" shows "Withdrawal" entry with date and -£50.00 in red.' },
    { id: 'TC-9.6', name: 'Goal completion', pri: 'HIGH',
      steps: 'Deposit to reach target amount.',
      expected: '"✓ Goal reached!" green badge. Deposit/Withdraw buttons hidden. Progress bar at 100%.' },
    { id: 'TC-9.7', name: 'Summary cards', pri: 'MED',
      steps: 'View the top of the Savings panel.',
      expected: 'Total Saved (green) and Active Goals count. Active = goals not yet at target.' },
    { id: 'TC-9.8', name: 'Monthly auto-save', pri: 'HIGH',
      steps: 'Set monthly contribution. Simulate month change.',
      expected: 'Amount increases by contribution. "Auto-save" entry appears in Transaction History.' },
    { id: 'TC-9.9', name: 'Goal estimate', pri: 'MED',
      steps: 'View goal with monthly contribution and remaining balance.',
      expected: '"~X months to go" pill shown. Recalculates when deposits/withdrawals change the remaining amount.' },
    { id: 'TC-9.10', name: 'Transaction history collapsible', pri: 'MED',
      steps: 'Make a deposit, then tap "Transaction History (N)".',
      expected: 'History expands with chevron rotation. Entries in reverse chronological order: type (Deposit green / Withdrawal red / Auto-save green), date, amount.' },
    { id: 'TC-9.11', name: 'Edit savings goal', pri: 'HIGH',
      steps: 'Tap pencil icon, change target and monthly amount, tap Save.',
      expected: 'Values update. Progress bar and estimate recalculate.' },
    { id: 'TC-9.12', name: 'Delete savings goal', pri: 'MED',
      steps: 'Tap trash icon, confirm.',
      expected: 'Removed. Total saved summary updates.' },
  ]},
  { num: '10', title: 'Data Persistence & Storage', cases: [
    { id: 'TC-10.1', name: 'Persists after close/reopen', pri: 'HIGH',
      steps: 'Add data, close app completely, reopen.',
      expected: 'All data intact. No loss.' },
    { id: 'TC-10.2', name: 'Capacitor Preferences used', pri: 'HIGH',
      steps: 'On device, add data and reopen.',
      expected: 'Data via Capacitor Preferences, not localStorage.' },
    { id: 'TC-10.3', name: 'localStorage fallback in browser', pri: 'MED',
      steps: 'Open in desktop browser (npm run dev), add data, refresh.',
      expected: 'Data persists via localStorage fallback.' },
    { id: 'TC-10.4', name: 'Month rollover processing', pri: 'HIGH',
      steps: 'Set lastMonth to previous month, reopen.',
      expected: 'Bills reset. Auto-pay re-evaluates. Debt auto-reduces. Savings auto-deposits.' },
    { id: 'TC-10.5', name: 'Large dataset performance', pri: 'MED',
      steps: 'Add 50+ bills, 10+ debts, 10+ savings.',
      expected: 'App responsive. No storage errors.' },
    { id: 'TC-10.6', name: 'Corrupted storage recovery', pri: 'LOW',
      steps: 'Corrupt bills-data key (invalid JSON), open app.',
      expected: 'Falls back to initial bills. Console logs error.' },
  ]},
  { num: '11', title: 'UI / Responsiveness / Edge Cases', cases: [
    { id: 'TC-11.1', name: 'Modal scroll lock', pri: 'HIGH',
      steps: 'Open modal while scrolled down.',
      expected: 'Body locks. Scroll position restored on close.' },
    { id: 'TC-11.2', name: 'Modal dismiss on backdrop tap', pri: 'MED',
      steps: 'Open modal, tap dark overlay.',
      expected: 'Modal closes. Form resets.' },
    { id: 'TC-11.3', name: 'Date input styling', pri: 'MED',
      steps: 'Tap a date input.',
      expected: '"Select date..." placeholder. Native picker. Date displays after. has-value class added.' },
    { id: 'TC-11.4', name: 'Large amounts display', pri: 'LOW',
      steps: 'Set income to 999999.99.',
      expected: 'No overflow. Word-break. Layout intact.' },
    { id: 'TC-11.5', name: 'Glass card hover effects', pri: 'LOW',
      steps: 'Hover over cards (desktop).',
      expected: 'translateY(-2px), increased shadow, brighter border.' },
    { id: 'TC-11.6', name: 'Category add and delete', pri: 'MED',
      steps: 'Add "GROCERIES". Assign a bill. Try deleting.',
      expected: 'Cannot delete with bills assigned. Can delete when empty.' },
    { id: 'TC-11.7', name: 'Number input sticky 0 fix', pri: 'HIGH',
      steps: 'On any number input (income, bill edit, debt payment, savings deposit), clear the field completely.',
      expected: 'Field empties fully. No sticky 0. Value resolves to 0 on blur (tap away from field).' },
  ]},
];

const STORAGE_KEY = 'tally-test-results';
let results = {};

function loadResults() {
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) results = JSON.parse(stored);
  } catch(e) {}
}

function saveResults() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(results));
}

function setResult(id, status) {
  if (results[id] === status) {
    delete results[id];
  } else {
    results[id] = status;
  }
  saveResults();
  updateUI();
}

function updateUI() {
  let total = 0, pass = 0, fail = 0, skip = 0;
  DATA.forEach(s => s.cases.forEach(c => {
    total++;
    const r = results[c.id];
    if (r === 'pass') pass++;
    else if (r === 'fail') fail++;
    else if (r === 'skip') skip++;
  }));

  const done = pass + fail + skip;
  const pct = total > 0 ? Math.round((done / total) * 100) : 0;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabel').textContent = pct + '%';
  document.getElementById('countPass').textContent = pass;
  document.getElementById('countFail').textContent = fail;
  document.getElementById('countSkip').textContent = skip;

  // Update section progress
  DATA.forEach(s => {
    let sDone = 0;
    s.cases.forEach(c => { if (results[c.id]) sDone++; });
    const el = document.getElementById('sec-prog-' + s.num);
    if (el) el.textContent = sDone + '/' + s.cases.length;
  });

  // Update card classes
  document.querySelectorAll('.tc-card').forEach(card => {
    const id = card.dataset.id;
    card.classList.remove('pass', 'fail');
    if (results[id] === 'pass') card.classList.add('pass');
    if (results[id] === 'fail') card.classList.add('fail');
  });

  // Update button active states
  document.querySelectorAll('.tc-btn').forEach(btn => {
    const id = btn.dataset.id;
    const type = btn.dataset.type;
    btn.classList.toggle('active', results[id] === type);
  });
}

function toggleSection(num) {
  document.getElementById('section-' + num).classList.toggle('open');
}

function resetAll() {
  if (confirm('Reset all test results? This cannot be undone.')) {
    results = {};
    saveResults();
    updateUI();
  }
}

function render() {
  const container = document.getElementById('sections');
  let html = '';

  DATA.forEach(section => {
    html += `<div class="section open" id="section-${section.num}">`;
    html += `<div class="section-header" onclick="toggleSection('${section.num}')">`;
    html += `<div class="section-header-left">`;
    html += `<span class="section-num">${section.num}</span>`;
    html += `<span class="section-title">${section.title}</span>`;
    html += `</div>`;
    html += `<div class="section-header-right">`;
    html += `<span class="section-progress" id="sec-prog-${section.num}">0/${section.cases.length}</span>`;
    html += `<svg class="section-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>`;
    html += `</div></div>`;
    html += `<div class="section-body">`;

    section.cases.forEach(tc => {
      const priClass = tc.pri.toLowerCase();
      html += `<div class="tc-card" data-id="${tc.id}">`;
      html += `<div class="tc-top">`;
      html += `<span class="tc-id">${tc.id}</span>`;
      html += `<span class="tc-name">${tc.name}</span>`;
      html += `<span class="tc-priority ${priClass}">${tc.pri}</span>`;
      html += `</div>`;
      html += `<div class="tc-details">`;
      html += `<div class="tc-row"><strong>Steps: </strong>${tc.steps}</div>`;
      html += `<div class="tc-row"><strong>Expected: </strong>${tc.expected}</div>`;
      html += `</div>`;
      html += `<div class="tc-actions">`;
      html += `<button class="tc-btn pass-btn" data-id="${tc.id}" data-type="pass" onclick="setResult('${tc.id}','pass')">✓ Pass</button>`;
      html += `<button class="tc-btn fail-btn" data-id="${tc.id}" data-type="fail" onclick="setResult('${tc.id}','fail')">✗ Fail</button>`;
      html += `<button class="tc-btn skip-btn" data-id="${tc.id}" data-type="skip" onclick="setResult('${tc.id}','skip')">— Skip</button>`;
      html += `</div>`;
      html += `<div class="tc-notes"><textarea placeholder="What went wrong? Describe the issue..." oninput="results['${tc.id}_note']=this.value;saveResults()"></textarea></div>`;
      html += `</div>`;
    });

    html += `</div></div>`;
  });

  container.innerHTML = html;

  // Restore notes
  document.querySelectorAll('.tc-notes textarea').forEach(ta => {
    const id = ta.closest('.tc-card').dataset.id;
    if (results[id + '_note']) ta.value = results[id + '_note'];
  });

  updateUI();
}

loadResults();
render();
</script>
</body>
</html>
